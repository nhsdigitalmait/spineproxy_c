POST /reliablemessaging/queryrequest HTTP/1.1
Host: 192.168.128.11
SOAPAction: urn:nhs:names:services:pdsquery/QUPA_IN000006UK02
Content-Length: 6303
Content-Type: multipart/related; boundary="--=_MIME-Boundary"; type="text/xml"; start="<ebXMLHeader@spine.nhs.uk>"
Connection: close

----=_MIME-Boundary
Content-Id: <ebXMLHeader@spine.nhs.uk>
Content-Type: text/xml; charset=UTF-8
Content-Transfer-Encoding: 8bit

<?xml version="1.0" encoding="UTF-8"?>
<SOAP:Envelope xmlns:xsi="http://www.w3c.org/2001/XML-Schema-Instance" xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eb="http://www.oasis-open.org/committees/ebxml-msg/schema/msg-header-2_0.xsd" xmlns:hl7ebxml="urn:hl7-org:transport/ebxml/DSTUv1.0" xmlns:xlink="http://www.w3.org/1999/xlink">
<SOAP:Header>
	<eb:MessageHeader SOAP:mustUnderstand="1" eb:version="2.0">
		<eb:From>
			<eb:PartyId eb:type="urn:nhs:names:partyType:ocs+serviceInstance">RHM-801710</eb:PartyId>
		</eb:From>
		<eb:To>
			<eb:PartyId eb:type="urn:nhs:names:partyType:ocs+serviceInstance">YEA-801248</eb:PartyId>
		</eb:To>
		<eb:CPAId>S2001924A2012004</eb:CPAId>
		<eb:ConversationId>F8C8FBFD-E89E-11EB-86CA-3B8608557050</eb:ConversationId>
		<eb:Service>urn:nhs:names:services:pdsquery</eb:Service>
		<eb:Action>QUPA_IN000006UK02</eb:Action>
		<eb:MessageData>
			<eb:MessageId>F8C8FBFD-E89E-11EB-86CA-3B8608557050</eb:MessageId>
			<eb:Timestamp>2021-07-19T15:38:24Z</eb:Timestamp>
		</eb:MessageData>
		
	</eb:MessageHeader>
	
	<eb:SyncReply SOAP:mustUnderstand="1" eb:version="2.0" SOAP:actor="http://schemas.xmlsoap.org/soap/actor/next"/>
</SOAP:Header>
<SOAP:Body>
	<eb:Manifest SOAP:mustUnderstand="1" eb:version="2.0">
		<eb:Reference xlink:href="cid:f8c8fbfe-e89e-11eb-86ca-3b8608557050@spine.nhs.uk">
			<eb:Schema eb:location="http://www.nhsia.nhs.uk/schemas/HL7-Message.xsd" eb:version="1.0"/>
			<eb:Description xml:lang="en">HL7 payload</eb:Description> 
			<hl7ebxml:Payload style="HL7" encoding="XML" version="3.0"/>
		</eb:Reference>
		
	</eb:Manifest>
</SOAP:Body>
</SOAP:Envelope>

----=_MIME-Boundary
Content-Id: <f8c8fbfe-e89e-11eb-86ca-3b8608557050@spine.nhs.uk>
Content-Type: application/xml; charset=UTF-8
Content-Transfer-Encoding: 8bit

<QUPA_IN000006UK02 xmlns="urn:hl7-org:v3">
    <id root="BB64F564-E3DF-4B05-865B-3358467817E7" />
    <creationTime value="20210719153808" />
    <versionCode code="V3NPfIT3.0" />
    <interactionId root="2.16.840.1.113883.2.1.3.2.4.12" extension="QUPA_IN000006UK02" />
    <processingCode code="P" />
    <processingModeCode code="T" />
    <acceptAckCode code="NE" />
    <communicationFunctionRcv typeCode="RCV">
        <device classCode="DEV" determinerCode="INSTANCE">
            <!--Destination ASID derived from file /mnt/encrypted/home/simonfarrow/Documents/msgxmit1/yea_s2_int.xml for environment sp2.int-->
            <id root="1.2.826.0.1285.0.2.0.107" extension="908232220511" />
        </device>
    </communicationFunctionRcv>
    <communicationFunctionSnd typeCode="SND">
        <device classCode="DEV" determinerCode="INSTANCE">
            <!--Source ASID derived from file /mnt/encrypted/home/simonfarrow/Documents/msgxmit1/yea_s2_int.xml for environment sp2.int-->
            <id root="1.2.826.0.1285.0.2.0.107" extension="918999199496" />
        </device>
    </communicationFunctionSnd>
    <ControlActEvent classCode="CACT" moodCode="EVN">
        <author typeCode="AUT">
            <AgentPersonSDS classCode="AGNT">
                <id root="1.2.826.0.1285.0.2.0.67" extension="781733617547" />
                <agentPersonSDS classCode="PSN" determinerCode="INSTANCE">
                    <id root="1.2.826.0.1285.0.2.0.65" extension="102053919984" />
                </agentPersonSDS>
                <part typeCode="PART">
                    <partSDSRole classCode="ROL">
                        <id root="1.2.826.0.1285.0.2.1.104" extension="ABCD" />
                    </partSDSRole>
                </part>
            </AgentPersonSDS>
        </author>
        <author1 typeCode="AUT">
            <AgentSystemSDS classCode="AGNT">
                <agentSystemSDS classCode="DEV" determinerCode="INSTANCE">
                    <id root="1.2.826.0.1285.0.2.0.107" extension="715373337545" />
                </agentSystemSDS>
            </AgentSystemSDS>
        </author1>
        <query>
            <!-- mim 6,7 template -->
            <historicDataIndicator>
                <semanticsText>HistoricDataIndicator</semanticsText>
                <value code="1" codeSystem="2.16.840.1.113883.2.1.3.2.4.17.36" />
            </historicDataIndicator>
            <person.address>
                <semanticsText>Person.address</semanticsText>
                <value>
                    <postalCode>DE22 3JD</postalCode>
                </value>
            </person.address>
            <person.administrativeGenderCode>
                <semanticsText>Person.administrativeGenderCode</semanticsText>
                <value code="1" />
            </person.administrativeGenderCode>
            <person.birthTime>
                <semanticsText>Person.birthTime</semanticsText>
                <!-- NB Example in mim has this totally wrong has value value="" not value center value="" -->
                <value>
                    <center value="19570108" />
                </value>
            </person.birthTime>
            <!-- Full date of death -->
            <!--
    <person.deceasedTime>
        <semanticsText>Person.deceasedTime</semanticsText>
        <value>
            <center value="20031202" />
        </value>
    </person.deceasedTime>
	-->
            <!-- NHS number -->
            <!--
    <person.id>
        <semanticsText>Person.id</semanticsText>
        <value root="2.16.840.1.113883.2.1.4.1" extension="9999999484" />
    </person.id>
	-->
            <person.name>
                <semanticsText>Person.name</semanticsText>
                <value use="L">
                    <family>O'LEARY</family>
                </value>
            </person.name>
            <!-- GP Practice Code -->
            <!--
	<primaryCare.id>
		<semanticsText>PrimaryCare.id</semanticsText>
		<value root="2.16.840.1.113883.2.1.4.2" extension="G1234567"/>
	</primaryCare.id>
	-->
            <!-- algorithmic (2) or alpha (1) -->
            <searchParameter>
                <semanticsText>SearchParameter</semanticsText>
                <value code="2" codeSystem="2.16.840.1.113883.2.1.3.2.4.17.39" />
            </searchParameter>
        </query>
    </ControlActEvent>
</QUPA_IN000006UK02>
----=_MIME-Boundary--
